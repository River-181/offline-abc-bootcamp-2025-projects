<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ÏùºÏùº Î™©Ìëú Í¥ÄÎ¶¨ Ïï±</title>
    <style>
        /* --- Reset & Fonts --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        :root {
            --bg-light: #f8f9fa; --text-light: #212529; --card-light: #ffffff;
            --bg-dark: #1a1a1a; --text-dark: #e9ecef; --card-dark: #2c2c2c;
            --primary: #007bff; --primary-light: #e6f2ff;
            --success: #28a745; --danger: #dc3545;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --gradient: linear-gradient(135deg, #667eea, #764ba2);
        }
        [data-theme="dark"] {
            --bg-light: var(--bg-dark); --text-light: var(--text-dark); --card-light: var(--card-dark);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: background-color 0.3s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- App Layout --- */
        #app-container { max-width: 500px; margin: 0 auto; padding: 20px; }
        header { text-align: center; margin-bottom: 20px; }
        h1 { font-size: 2.5rem; font-weight: 900; }
        
        /* --- Overall Progress --- */
        #overall-progress {
            display: flex; justify-content: space-around; align-items: center;
            padding: 15px; background: var(--card-light); border-radius: 15px;
            box-shadow: var(--shadow); margin-bottom: 20px;
        }
        #overall-percentage { font-size: 2.5rem; font-weight: 700; color: var(--primary); }
        #overall-emoji { font-size: 3rem; }
        #streak-counter { font-size: 1.5rem; display: flex; align-items: center; gap: 5px; }

        /* --- Goal List --- */
        #goal-list { display: grid; gap: 15px; }
        .goal-card {
            display: flex; align-items: center; gap: 15px;
            background: var(--card-light);
            padding: 15px; border-radius: 15px; box-shadow: var(--shadow);
            transition: transform 0.2s, opacity 0.3s;
            position: relative;
        }
        .goal-card.completed { opacity: 0.7; background: var(--primary-light); }
        .goal-card.dragging { opacity: 0.5; }
        .goal-icon { font-size: 2.5rem; }
        .goal-details { flex-grow: 1; }
        .goal-title { font-size: 1.1rem; font-weight: 700; }
        .goal-progress-text { font-size: 0.9rem; color: #888; }
        .goal-controls { display: flex; align-items: center; gap: 10px; }
        .progress-circle { width: 60px; height: 60px; position: relative; }
        .progress-circle svg { transform: rotate(-90deg); }
        .progress-circle circle { transition: stroke-dashoffset 0.5s; }
        .progress-circle .percent-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 700; }
        .btn-control {
            width: 30px; height: 30px; border-radius: 50%; border: none;
            background: #eee; font-size: 1.5rem; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
        }
        .progress-slider { width: 100%; margin-top: 10px; }

        /* --- Footer & Buttons --- */
        footer { text-align: center; margin-top: 20px; }
        #daily-quote { font-style: italic; margin-bottom: 20px; }
        #add-goal-btn {
            width: 60px; height: 60px; border-radius: 50%; border: none;
            background: var(--gradient); color: white; font-size: 2.5rem;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: fixed; bottom: 30px; right: 30px;
        }
        
        /* --- Modal --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: flex;
            justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background: var(--card-light); padding: 30px; border-radius: 15px;
            width: 90%; max-width: 400px;
        }
        .modal-content h2 { margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-group input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: #ccc; }

        /* --- Confetti --- */
        .confetti {
            width: 10px; height: 10px; background-color: #f00;
            position: absolute; top: -20px;
            animation: fall 3s linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        /* --- Theme Toggle --- */
        #theme-toggle {
            position: absolute; top: 20px; right: 20px;
            cursor: pointer; font-size: 1.5rem;
        }
    </style>
</head>
<body>

    <div id="app-container">
        <header>
            <span id="theme-toggle">üåô</span>
            <h1>Ïò§ÎäòÏùò Î™©Ìëú</h1>
            <div id="overall-progress">
                <span id="overall-emoji">üòä</span>
                <div id="overall-percentage">0%</div>
                <div id="streak-counter">üî• 0</div>
            </div>
        </header>

        <main id="goal-list"></main>

        <footer>
            <div id="daily-quote"></div>
            <button id="add-goal-btn" aria-label="ÏÉà Î™©Ìëú Ï∂îÍ∞Ä">+</button>
        </footer>
    </div>

    <!-- Add Goal Modal -->
    <div id="add-goal-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>ÏÉà Î™©Ìëú Ï∂îÍ∞Ä</h2>
            <form id="add-goal-form">
                <div class="form-group">
                    <label for="goal-title">Î™©Ìëú</label>
                    <input type="text" id="goal-title-input" placeholder="Ïòà: Î¨º ÎßàÏãúÍ∏∞" required>
                </div>
                <div class="form-group">
                    <label for="goal-target">Î™©ÌëúÏπò</label>
                    <input type="number" id="goal-target-input" placeholder="Ïòà: 8" required min="1">
                </div>
                <div class="form-group">
                    <label for="goal-unit">Îã®ÏúÑ</label>
                    <input type="text" id="goal-unit-input" placeholder="Ïòà: Ïûî" required>
                </div>
                <div class="form-group">
                    <label for="goal-icon">ÏïÑÏù¥ÏΩò (Ïù¥Î™®ÏßÄ)</label>
                    <input type="text" id="goal-icon-input" value="üíß" maxlength="2">
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" id="cancel-add-goal">Ï∑®ÏÜå</button>
                    <button type="submit" class="btn btn-primary">Ï∂îÍ∞Ä</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const goalList = document.getElementById('goal-list');
        const addGoalBtn = document.getElementById('add-goal-btn');
        const addGoalModal = document.getElementById('add-goal-modal');
        const addGoalForm = document.getElementById('add-goal-form');
        const cancelAddGoalBtn = document.getElementById('cancel-add-goal');
        const overallPercentageEl = document.getElementById('overall-percentage');
        const overallEmojiEl = document.getElementById('overall-emoji');
        const streakCounterEl = document.getElementById('streak-counter');
        const dailyQuoteEl = document.getElementById('daily-quote');
        const themeToggle = document.getElementById('theme-toggle');

        // --- State ---
        let goals = [];
        let lastVisitDate = null;
        let streak = 0;

        // --- Data Persistence ---
        const loadData = () => {
            const data = JSON.parse(localStorage.getItem('goalAppData'));
            if (data) {
                goals = data.goals || [];
                lastVisitDate = data.lastVisitDate;
                streak = data.streak || 0;
            }
            checkDate();
            renderAll();
        };

        const saveData = () => {
            const data = {
                goals,
                lastVisitDate: new Date().toLocaleDateString(),
                streak
            };
            localStorage.setItem('goalAppData', JSON.stringify(data));
        };

        // --- Date & Streak Logic ---
        const checkDate = () => {
            const today = new Date().toLocaleDateString();
            if (lastVisitDate && lastVisitDate !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                const overallProgress = calculateOverallProgress();
                if (lastVisitDate === yesterday.toLocaleDateString() && overallProgress === 100) {
                    streak++;
                } else if (lastVisitDate !== yesterday.toLocaleDateString()) {
                    streak = 0;
                }
                
                // Reset goals for the new day
                goals.forEach(goal => goal.current = 0);
            }
            lastVisitDate = today;
            saveData();
        };

        // --- Rendering ---
        const renderGoals = () => {
            goalList.innerHTML = '';
            const sortedGoals = [...goals].sort((a, b) => a.completed - b.completed);

            if (sortedGoals.length === 0) {
                goalList.innerHTML = '<p style="text-align:center; color: #888;">ÏïÑÏßÅ Î™©ÌëúÍ∞Ä ÏóÜÏñ¥Ïöî. ÏßÄÍ∏à Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</p>';
                return;
            }

            sortedGoals.forEach((goal, index) => {
                const percentage = goal.target > 0 ? (goal.current / goal.target) * 100 : 0;
                const card = document.createElement('div');
                card.className = `goal-card ${goal.completed ? 'completed' : ''}`;
                card.dataset.id = goal.id;
                card.draggable = true;

                card.innerHTML = `
                    <div class="progress-circle">
                        <svg width="60" height="60" viewBox="0 0 36 36">
                            <circle cx="18" cy="18" r="16" fill="none" stroke="#eee" stroke-width="2"></circle>
                            <circle cx="18" cy="18" r="16" fill="none" stroke="${goal.completed ? 'var(--success)' : 'var(--primary)'}" stroke-width="2" stroke-dasharray="100" stroke-dashoffset="${100 - percentage}" stroke-linecap="round"></circle>
                        </svg>
                        <span class="percent-text">${Math.round(percentage)}%</span>
                    </div>
                    <div class="goal-icon">${goal.icon}</div>
                    <div class="goal-details">
                        <div class="goal-title">${goal.title}</div>
                        <div class="goal-progress-text">${goal.current} / ${goal.target} ${goal.unit}</div>
                        <input type="range" class="progress-slider" value="${goal.current}" max="${goal.target}" data-id="${goal.id}">
                    </div>
                    <div class="goal-controls">
                        <button class="btn-control btn-minus" data-id="${goal.id}">-</button>
                        <button class="btn-control btn-plus" data-id="${goal.id}">+</button>
                    </div>
                `;
                goalList.appendChild(card);
            });
        };

        const renderOverallProgress = () => {
            const percentage = calculateOverallProgress();
            overallPercentageEl.textContent = `${percentage}%`;
            
            if (percentage <= 30) overallEmojiEl.textContent = 'üò¢';
            else if (percentage <= 70) overallEmojiEl.textContent = 'üòä';
            else overallEmojiEl.textContent = 'üéâ';

            streakCounterEl.innerHTML = `üî• ${streak}`;
        };
        
        const renderAll = () => {
            renderGoals();
            renderOverallProgress();
            saveData();
        };

        // --- Goal Actions ---
        const addGoal = (title, target, unit, icon) => {
            const newGoal = {
                id: Date.now(),
                title,
                target: parseInt(target),
                unit,
                icon,
                current: 0,
                completed: false
            };
            goals.push(newGoal);
            renderAll();
        };

        const updateProgress = (id, amount) => {
            const goal = goals.find(g => g.id === id);
            if (!goal) return;

            goal.current = Math.max(0, Math.min(goal.target, goal.current + amount));
            
            const wasCompleted = goal.completed;
            goal.completed = goal.current >= goal.target;

            if (goal.completed && !wasCompleted) {
                showEncouragement();
            }
            
            const overallProgress = calculateOverallProgress();
            if (overallProgress === 100) {
                triggerConfetti();
            }

            renderAll();
        };
        
        const setProgress = (id, value) => {
            const goal = goals.find(g => g.id === id);
            if (!goal) return;
            goal.current = Math.max(0, Math.min(goal.target, value));
            goal.completed = goal.current >= goal.target;
            renderAll();
        };

        const deleteGoal = (id) => {
            goals = goals.filter(g => g.id !== id);
            renderAll();
        };

        // --- Calculations & Effects ---
        const calculateOverallProgress = () => {
            if (goals.length === 0) return 0;
            const totalProgress = goals.reduce((sum, goal) => {
                return sum + (goal.target > 0 ? (goal.current / goal.target) : 0);
            }, 0);
            return Math.round((totalProgress / goals.length) * 100);
        };

        const triggerConfetti = () => {
            const container = document.body;
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                container.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        };

        const showEncouragement = () => {
            const messages = ["Î©ãÏ†∏Ïöî!", "Í≥ÑÏÜç ÎÇòÏïÑÍ∞ÄÏÑ∏Ïöî!", "Í±∞Ïùò Îã§ ÏôîÏñ¥Ïöî!", "ÏµúÍ≥†ÏòàÏöî!", "ÏûòÌïòÍ≥† ÏûàÏñ¥Ïöî!"];
            const message = messages[Math.floor(Math.random() * messages.length)];
            const alert = document.createElement('div');
            alert.textContent = message;
            alert.style.cssText = `
                position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
                background: var(--gradient); color: white; padding: 15px 25px;
                border-radius: 10px; z-index: 2000; opacity: 0;
                transition: opacity 0.5s, top 0.5s;
            `;
            document.body.appendChild(alert);
            setTimeout(() => { alert.style.opacity = '1'; alert.style.top = '40px'; }, 10);
            setTimeout(() => { 
                alert.style.opacity = '0'; 
                setTimeout(() => alert.remove(), 500);
            }, 2500);
        };
        
        const fetchQuote = async () => {
            try {
                const response = await fetch("https://api.adviceslip.com/advice");
                const data = await response.json();
                dailyQuoteEl.textContent = `"${data.slip.advice}"`;
            } catch (error) {
                dailyQuoteEl.textContent = '"ÏÑ±Í≥µÏùò ÎπÑÍ≤∞ÏùÄ ÏãúÏûëÌïòÎäî Í≤ÉÏù¥Îã§." - ÎßàÌÅ¨ Ìä∏Ïõ®Ïù∏';
            }
        };

        // --- Event Listeners ---
        addGoalBtn.addEventListener('click', () => addGoalModal.classList.add('visible'));
        cancelAddGoalBtn.addEventListener('click', () => addGoalModal.classList.remove('visible'));
        addGoalModal.addEventListener('click', (e) => {
            if (e.target === addGoalModal) addGoalModal.classList.remove('visible');
        });

        addGoalForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('goal-title-input').value;
            const target = document.getElementById('goal-target-input').value;
            const unit = document.getElementById('goal-unit-input').value;
            const icon = document.getElementById('goal-icon-input').value;
            addGoal(title, target, unit, icon);
            addGoalForm.reset();
            document.getElementById('goal-icon-input').value = 'üíß';
            addGoalModal.classList.remove('visible');
        });

        goalList.addEventListener('click', (e) => {
            const id = parseInt(e.target.dataset.id);
            if (e.target.classList.contains('btn-plus')) {
                updateProgress(id, 1);
            } else if (e.target.classList.contains('btn-minus')) {
                updateProgress(id, -1);
            }
        });
        
        goalList.addEventListener('input', (e) => {
            if (e.target.classList.contains('progress-slider')) {
                const id = parseInt(e.target.dataset.id);
                const value = parseInt(e.target.value);
                setProgress(id, value);
            }
        });

        // --- Drag & Drop ---
        let draggedItem = null;
        goalList.addEventListener('dragstart', (e) => {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        });
        goalList.addEventListener('dragend', (e) => {
            e.target.classList.remove('dragging');
            const goalId = parseInt(draggedItem.dataset.id);
            const newIndex = Array.from(goalList.children).indexOf(draggedItem);
            const draggedGoal = goals.find(g => g.id === goalId);
            goals = goals.filter(g => g.id !== goalId);
            goals.splice(newIndex, 0, draggedGoal);
            saveData();
        });
        goalList.addEventListener('dragover', (e) => {
            e.preventDefault();
            const afterElement = getDragAfterElement(goalList, e.clientY);
            if (afterElement == null) {
                goalList.appendChild(draggedItem);
            } else {
                goalList.insertBefore(draggedItem, afterElement);
            }
        });
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.goal-card:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // --- Swipe to delete ---
        let touchstartX = 0;
        let touchendX = 0;
        goalList.addEventListener('touchstart', function(event) {
            touchstartX = event.changedTouches[0].screenX;
        }, false);
        goalList.addEventListener('touchend', function(event) {
            touchendX = event.changedTouches[0].screenX;
            handleSwipe(event.target.closest('.goal-card'));
        }, false); 
        
        function handleSwipe(card) {
            if (!card) return;
            if (touchendX < touchstartX - 50) { // Swiped left
                if (confirm(`'${card.querySelector('.goal-title').textContent}' Î™©ÌëúÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                    card.style.transform = 'translateX(-100%)';
                    card.style.opacity = '0';
                    setTimeout(() => deleteGoal(parseInt(card.dataset.id)), 300);
                }
            }
        }

        // --- Theme Toggle ---
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                themeToggle.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        });
        
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeToggle.textContent = '‚òÄÔ∏è';
        }

        // --- Initial Load ---
        loadData();
        fetchQuote();
    });
    </script>
</body>
</html>
